# textiot
A framework for building web and native (IoT) Dapps on the IPFS network.

An only one textiot.git was combined with https://github.com/textileio/go-textile and related git repos for easier development.

## Usage
### react-native

    npm install textiot --save

For RN < 0.60, run `react-native link textiot`.

For RN < 0.60 or >= 0.60, then:

#### Android
Because can not `npm publish` full 300MB package, so you have to install tools described bellow and

    cd node_modules/textiot/
    ./build-post-npm.sh

results:
```
go-textile/textile
go-textile/textile.exe
go-textile/textile-arm
android-textile/mobile
react-native-sdk/textile-androidx
react-native-sdk/textile-android
```

Add bellow into `android/settings.gradle`

androidx not android:
```
include ':textile-pb'
project(':textile-pb').projectDir = new File(rootProject.projectDir, '../node_modules/textiot/android-textile/pb-androidx')
include ':textile-mobile'
project(':textile-mobile').projectDir = new File(rootProject.projectDir, '../node_modules/textiot/android-textile/mobile')
include ':android-textile'
project(':android-textile').projectDir = new File(rootProject.projectDir, '../node_modules/textiot/react-native-sdk/textile-androidx')
```
and `cd node_modules/textiot; ./android2androidx.sh`

android not androidx:
```
include ':textile-pb'
project(':textile-pb').projectDir = new File(rootProject.projectDir, '../node_modules/textiot/android-textile/pb-android')
include ':textile-mobile'
project(':textile-mobile').projectDir = new File(rootProject.projectDir, '../node_modules/textiot/android-textile/mobile')
include ':android-textile'
project(':android-textile').projectDir = new File(rootProject.projectDir, '../node_modules/textiot/react-native-sdk/textile-android')
```
and `cd node_modules/textiot; ./androidx2android.sh`

    require('textiot/react-native-sdk').default;

#### iOS
Because can not `npm publish` full 300MB package, so you have to install tools described bellow and

    cd node_modules/textiot/
    ./build-mac.sh

results:
```
go-textile/textile-mac
go-textile/mobile/dist/ios/Mobile.framework/
go-textile/mobile/dist/ios/protos/
```

Add bellow (after `pod 'Folly'`) into `ios/Podfile`
```
  pod 'Textile', :path => '../node_modules/textiot/ios-textile'
  pod 'TextileCore', :path => '../node_modules/textiot/go-textile/mobile/dist/ios'
```

    cd ios
    pod install

    require('textiot/react-native-sdk').default;

### web

    npm install textiot --save

    require('textiot/js-http-client').default;

## Docs
### textile
[tour of Textile](docs/docs/a-tour-of-textile.md)

## Develop
### Install tools

#### golang >= 1.13.10
Before go1.13.1, iPhone App Store submission fails with non-public symbols `_ptrace` as described in https://github.com/golang/go/issues/31628 . I have not test go1.13.10 or go1.14 on App Store yet, so maybe you still need to install a hacked https://github.com/textileio/go.git described in https://github.com/textileio/go-textile/blob/master/.circleci/config.yml#L186

    go get golang.org/x/mobile/cmd/gomobile
    export PATH=~/go/bin:$PATH
    gomobile init

if `unrecognized import path "golang.org/x/mobile/cmd/gomobile` , then

    mkdir -p ~/go
    cd ~/go
    mkdir -p src/github.com/golang
    mkdir -p src/golang.org
    cd src/golang.org
    ln -s ../github.com/golang x
    cd ~/go/src/github.com/golang
    git clone https://github.com/golang/mobile
    git clone https://github.com/golang/tools
    go get golang.org/x/mobile/cmd/gomobile
    gomobile init

and also

    export GO111MODULE=on
    export GOPROXY=https://goproxy.io

#### android sdk

#### android ndk r20

#### nodejs <=10.15.3
With `go-textile/release/@textile/js-types/dist/index.d.ts` generated by `./node_modules/protobufjs/bin/pbts` running in nodejs 12.13.0 , will cause error in `npm run build` of react-native-sdk .

#### protoc 3.6.1 on Linux(sudo apt install protobuf-compiler), 3.x on macOS (brew install protobuf)
Need `protoc --version` to match change `com.google.protobuf:protobuf-java:3.6.1` in `go-textile/release/PBProject/pb/build.gradle`, otherwise will cause `error: cannot find symbol UnusedPrivateParameter` when `./gradlew pb:build` in `go-textile/release/PBProject/`.

On macOS, even changed `com.google.protobuf:protobuf-java:3.6.1` to `com.google.protobuf:protobuf-java:3.11.4` to match `protoc --version` and generated `pb-android.aar` successfully, the APP will crash `E AndroidRuntime: java.lang.NoSuchMethodError: No static method internalBuildGeneratedFileFrom([Ljava/lang/String;[Lcom/google/protobuf/Descriptors$FileDescriptor;)Lcom/google/protobuf/Descriptors$FileDescriptor; in class Lcom/google/protobuf/Descriptors$FileDescriptor; or its super classes` when run into `list.toByteArray()` of `final Model.ThreadList list` in `textiot/react-native-sdk/android/src/main/java/io/textile/rnmobile/ThreadsBridge.java`. When just replace `pb-android.aar` with the one generated on Linux, the APP compiled on macOS runs well.

And, the result of `protoc --proto_path=./pb/protos --objc_out=./mobile/dist/ios/protos ./pb/protos/*` on Linux and macOS is different.

So all will be built by `build.sh` on Linux except `mobile/dist/ios/protos` and `mobile/dist/ios/Mobile.framework/` by `build-mac.sh` on macOS.

#### suod apt install mingw-w64 gcc-arm-linux-gnueabihf

#### Xcode on macOS

### Build on Linux

    ./build.sh

results:
```
go-textile/textile
go-textile/textile.exe
go-textile/textile-arm
android-textile/pb-androidx
android-textile/pb-android
android-textile/mobile
react-native-sdk/textile-androidx
react-native-sdk/textile-android
react-native-sdk/dist/index.js
```

### Build on macOS

    ./build-mac.sh

results:
```
go-textile/textile-mac
go-textile/mobile/dist/ios/Mobile.framework/
go-textile/mobile/dist/ios/protos/
```

### Build on macOS

    ./build-web.sh

results:
```
js-http-client/dist/index.js
```
